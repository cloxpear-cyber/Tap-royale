<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tap Royale</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: white; overflow-x: hidden; }
        .container { max-width: 100%; padding: 10px; padding-bottom: 80px; }

        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 15px; margin-bottom: 10px; }
        .player-info { display: flex; flex-direction: column; }
        .player-name { font-size: 16px; font-weight: bold; }
        .player-level { font-size: 12px; color: #ffd700; }
        .currency-display { display: flex; gap: 15px; }
        .currency { display: flex; align-items: center; gap: 5px; font-size: 14px; font-weight: bold; }
        .gold { color: #ffd700; }
        .gems { color: #e91e63; }

        .daily-banner { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); border-radius: 15px; padding: 12px 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .daily-banner.claimed { background: rgba(255,255,255,0.1); cursor: default; }
        .daily-info { display: flex; align-items: center; gap: 10px; }
        .daily-text { font-size: 14px; font-weight: bold; }
        .daily-sub { font-size: 11px; opacity: 0.9; }
        .daily-btn { background: rgba(255,255,255,0.3); border: none; padding: 8px 15px; border-radius: 20px; color: white; font-weight: bold; }

        .arena-container { position: relative; height: 280px; border-radius: 20px; overflow: hidden; margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: background 0.5s ease; }
        .arena-header { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: bold; }
        .character { font-size: 100px; cursor: pointer; user-select: none; transition: transform 0.1s; filter: drop-shadow(0 0 20px rgba(255,255,255,0.3)); }
        .character:active { transform: scale(0.85); }

        .tap-feedback { position: absolute; pointer-events: none; font-size: 24px; font-weight: bold; color: #ffd700; text-shadow: 0 0 10px rgba(255,215,0,0.8); animation: float-up 0.8s ease-out forwards; }
        @keyframes float-up { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }

        .progress-section { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; margin-bottom: 10px; }
        .progress-item { margin-bottom: 10px; }
        .progress-item:last-child { margin-bottom: 0; }
        .progress-label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; }
        .progress-bar { height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.3s ease; }
        .progress-fill.exp { background: linear-gradient(90deg, #4caf50, #8bc34a); }
        .progress-fill.arena { background: linear-gradient(90deg, #2196f3, #03a9f4); }

        .stats-row { display: flex; justify-content: space-around; background: rgba(255,255,255,0.1); border-radius: 15px; padding: 10px; margin-bottom: 10px; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; color: #ffd700; }
        .stat-label { font-size: 10px; opacity: 0.7; }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; display: flex; background: rgba(26, 26, 46, 0.98); border-top: 1px solid rgba(255,255,255,0.1); padding: 8px 0; padding-bottom: max(8px, env(safe-area-inset-bottom)); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 5px; cursor: pointer; opacity: 0.5; }
        .nav-item.active { opacity: 1; }
        .nav-item span:first-child { font-size: 22px; }
        .nav-item span:last-child { font-size: 10px; margin-top: 2px; }

        .screen { display: none; }
        .screen.active { display: block; }

        .shop-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .shop-title { font-size: 20px; font-weight: bold; }
        .shop-currency { display: flex; gap: 10px; }
        .shop-currency .currency { background: rgba(255,255,255,0.1); padding: 6px 10px; border-radius: 15px; font-size: 13px; }

        .shop-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .shop-tab { flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; color: white; font-size: 14px; cursor: pointer; }
        .shop-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

        .shop-items { display: flex; flex-direction: column; gap: 10px; }
        .shop-item { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .item-info h3 { font-size: 15px; margin-bottom: 3px; }
        .item-info p { font-size: 11px; opacity: 0.7; }
        .item-level { font-size: 11px; color: #4caf50; margin-top: 2px; }

        .buy-btn { padding: 10px 16px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 13px; }
        .buy-btn:active { transform: scale(0.95); }
        .buy-btn.gold-btn { background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%); color: #1a1a2e; }
        .buy-btn.gem-btn { background: linear-gradient(135deg, #e91e63 0%, #9c27b0 100%); color: white; }

        .referral-section { background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(102, 126, 234, 0.3); }
        .referral-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; }
        .referral-stats { display: flex; justify-content: space-around; margin-bottom: 15px; }
        .ref-stat { text-align: center; }
        .ref-stat-value { font-size: 24px; font-weight: bold; color: #ffd700; }
        .ref-stat-label { font-size: 11px; opacity: 0.7; }
        .referral-info { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px; margin-bottom: 15px; font-size: 12px; line-height: 1.6; }
        .invite-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; }
        .ref-link-box { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 10px; margin-top: 10px; display: flex; align-items: center; gap: 10px; }
        .ref-link-text { flex: 1; font-size: 10px; word-break: break-all; opacity: 0.8; }
        .copy-btn { background: rgba(255,255,255,0.2); border: none; padding: 8px 12px; border-radius: 8px; color: white; font-size: 14px; cursor: pointer; }

        .leaderboard-list { display: flex; flex-direction: column; gap: 8px; }
        .leaderboard-item { background: rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; display: flex; align-items: center; gap: 12px; }
        .leaderboard-item.me { background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%); border: 1px solid rgba(102, 126, 234, 0.5); }
        .rank { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 13px; background: rgba(255,255,255,0.2); }
        .rank.top1 { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #1a1a2e; }
        .rank.top2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #1a1a2e; }
        .rank.top3 { background: linear-gradient(135deg, #cd7f32, #a0522d); color: white; }
        .lb-info { flex: 1; }
        .lb-name { font-size: 14px; font-weight: bold; }
        .lb-arena { font-size: 11px; opacity: 0.7; }
        .lb-value { font-size: 14px; font-weight: bold; color: #ffd700; }

        .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(0,0,0,0.9); color: white; padding: 12px 24px; border-radius: 25px; font-size: 14px; opacity: 0; transition: all 0.3s ease; z-index: 1000; text-align: center; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.error { background: #f44336; }
        .toast.success { background: #4caf50; }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-overlay.show { display: flex; }
        .modal { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 20px; padding: 25px; width: 100%; max-width: 300px; text-align: center; }
        .modal-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; }
        .modal-icon { font-size: 50px; margin-bottom: 15px; }
        .modal-rewards { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; }
        .modal-reward { text-align: center; }
        .modal-reward-icon { font-size: 28px; }
        .modal-reward-amount { font-size: 18px; font-weight: bold; color: #ffd700; }
        .modal-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; }
        .modal-btn:disabled { background: #555; }

        .active-boosts { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
        .boost-badge { background: linear-gradient(135deg, #e91e63 0%, #9c27b0 100%); padding: 5px 10px; border-radius: 15px; font-size: 11px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- GAME SCREEN -->
        <div id="screen-game" class="screen active">
            <div class="header">
                <div class="player-info">
                    <div class="player-name" id="player-name">–ò–≥—Ä–æ–∫</div>
                    <div class="player-level">–£—Ä–æ–≤–µ–Ω—å <span id="player-level">1</span></div>
                </div>
                <div class="currency-display">
                    <div class="currency gold">ü™ô <span id="gold-display">0</span></div>
                    <div class="currency gems">üíé <span id="gems-display">0</span></div>
                </div>
            </div>

            <div id="daily-banner" class="daily-banner">
                <div class="daily-info">
                    <span style="font-size:24px">üéÅ</span>
                    <div>
                        <div class="daily-text">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞!</div>
                        <div class="daily-sub">–î–µ–Ω—å <span id="daily-streak">1</span></div>
                    </div>
                </div>
                <div class="daily-btn">–ó–∞–±—Ä–∞—Ç—å</div>
            </div>

            <div id="active-boosts" class="active-boosts"></div>

            <div id="arena-container" class="arena-container" style="background: linear-gradient(135deg, #2d5016 0%, #1a3a0a 100%);">
                <div class="arena-header">
                    <span id="arena-hero">üó°Ô∏è</span>
                    <span id="arena-name">üè∞ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –ª–∞–≥–µ—Ä—å</span>
                </div>
                <div class="character" id="character">üó°Ô∏è</div>
            </div>

            <div class="progress-section">
                <div class="progress-item">
                    <div class="progress-label">
                        <span>–û–ø—ã—Ç</span>
                        <span><span id="current-exp">0</span> / <span id="exp-needed">100</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill exp" id="exp-bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>–î–æ –∞—Ä–µ–Ω—ã</span>
                        <span>–£—Ä. <span id="next-arena-level">5</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill arena" id="arena-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-value" id="gold-per-tap">+1</div>
                    <div class="stat-label">–∑–∞ —Ç–∞–ø</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="gold-per-sec">+0</div>
                    <div class="stat-label">–≤ —Å–µ–∫—É–Ω–¥—É</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-taps">0</div>
                    <div class="stat-label">—Ç–∞–ø–æ–≤</div>
                </div>
            </div>
        </div>

        <!-- SHOP SCREEN -->
        <div id="screen-shop" class="screen">
            <div class="shop-header">
                <div class="shop-title">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="shop-currency">
                    <div class="currency gold">ü™ô <span id="shop-gold">0</span></div>
                    <div class="currency gems">üíé <span id="shop-gems">0</span></div>
                </div>
            </div>

            <div class="shop-tabs">
                <button class="shop-tab active" id="tab-gold">ü™ô –ó–æ–ª–æ—Ç–æ</button>
                <button class="shop-tab" id="tab-gems">üíé –ì–µ–º—ã</button>
            </div>

            <div id="shop-gold-items" class="shop-items">
                <div class="shop-item">
                    <div class="item-info">
                        <h3>‚ö° –°–∏–ª–∞ —Ç–∞–ø–∞</h3>
                        <p>+2 –∑–æ–ª–æ—Ç–∞ –∑–∞ –∫–ª–∏–∫</p>
                        <div class="item-level">–£—Ä–æ–≤–µ–Ω—å: <span id="lvl-tap">0</span></div>
                    </div>
                    <button class="buy-btn gold-btn" id="buy-tap">ü™ô <span id="cost-tap">100</span></button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <h3>ü§ñ –ê–≤—Ç–æ-–¥–æ—Ö–æ–¥</h3>
                        <p>+5 –∑–æ–ª–æ—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥—É</p>
                        <div class="item-level">–£—Ä–æ–≤–µ–Ω—å: <span id="lvl-auto">0</span></div>
                    </div>
                    <button class="buy-btn gold-btn" id="buy-auto">ü™ô <span id="cost-auto">250</span></button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üìà –û–ø—ã—Ç</h3>
                        <p>+1 –æ–ø—ã—Ç –∑–∞ –∫–ª–∏–∫</p>
                        <div class="item-level">–£—Ä–æ–≤–µ–Ω—å: <span id="lvl-exp">0</span></div>
                    </div>
                    <button class="buy-btn gold-btn" id="buy-exp">ü™ô <span id="cost-exp">500</span></button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üéØ –ö—Ä–∏—Ç</h3>
                        <p>–®–∞–Ω—Å x3 –∑–æ–ª–æ—Ç–∞</p>
                        <div class="item-level">–£—Ä–æ–≤–µ–Ω—å: <span id="lvl-crit">0</span></div>
                    </div>
                    <button class="buy-btn gold-btn" id="buy-crit">ü™ô <span id="cost-crit">1000</span></button>
                </div>
            </div>

            <div id="shop-gems-items" class="shop-items" style="display:none">
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üî• x2 –∑–æ–ª–æ—Ç–æ</h3>
                        <p>–ù–∞ 5 –º–∏–Ω—É—Ç</p>
                    </div>
                    <button class="buy-btn gem-btn" id="buy-double">üíé 5</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üí• x10 —Ç–∞–ø</h3>
                        <p>–ù–∞ 1 –º–∏–Ω—É—Ç—É</p>
                    </div>
                    <button class="buy-btn gem-btn" id="buy-super">üíé 10</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <h3>‚≠ê +1000 –æ–ø—ã—Ç–∞</h3>
                        <p>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</p>
                    </div>
                    <button class="buy-btn gem-btn" id="buy-megaexp">üíé 8</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üí∞ +500 –∑–æ–ª–æ—Ç–∞</h3>
                        <p>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</p>
                    </div>
                    <button class="buy-btn gem-btn" id="buy-gold500">üíé 3</button>
                </div>
            </div>
        </div>

        <!-- TOP SCREEN -->
        <div id="screen-top" class="screen">
            <h2 style="text-align:center;margin-bottom:15px">üèÜ –†–µ–π—Ç–∏–Ω–≥</h2>

            <div class="referral-section">
                <div class="referral-title">üë• –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</div>
                <div class="referral-stats">
                    <div class="ref-stat">
                        <div class="ref-stat-value" id="ref-count">0</div>
                        <div class="ref-stat-label">–¥—Ä—É–∑–µ–π</div>
                    </div>
                    <div class="ref-stat">
                        <div class="ref-stat-value" id="ref-bonus">+0</div>
                        <div class="ref-stat-label">–±–æ–Ω—É—Å/—Å–µ–∫</div>
                    </div>
                </div>
                <div class="referral-info">
                    üéÅ –ó–∞ –¥—Ä—É–≥–∞: +500 –∑–æ–ª–æ—Ç–∞, +3 –≥–µ–º–∞<br>
                    üí∞ –ü–∞—Å—Å–∏–≤: +5 –∑–æ–ª–æ—Ç–∞/—Å–µ–∫ –∑–∞ –¥—Ä—É–≥–∞
                </div>
                <button class="invite-btn" id="invite-btn">üì® –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
                <div class="ref-link-box">
                    <div class="ref-link-text" id="ref-link">–°—Å—ã–ª–∫–∞...</div>
                    <button class="copy-btn" id="copy-btn">üìã</button>
                </div>
            </div>

            <div id="leaderboard" class="leaderboard-list"></div>
        </div>

        <!-- INFO SCREEN -->
        <div id="screen-info" class="screen">
            <h2 style="text-align:center;margin-bottom:15px">üìñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div style="background:rgba(255,255,255,0.1);border-radius:15px;padding:15px;margin-bottom:10px">
                <h3 style="margin-bottom:10px">üèüÔ∏è –ê—Ä–µ–Ω—ã</h3>
                <div id="arenas-list" style="font-size:13px;line-height:1.8"></div>
            </div>
            <div style="background:rgba(255,255,255,0.1);border-radius:15px;padding:15px">
                <h3 style="margin-bottom:10px">üí° –°–æ–≤–µ—Ç—ã</h3>
                <p style="font-size:13px;line-height:1.8">
                    ‚ö° –ö–∞—á–∞–π —Å–∏–ª—É —Ç–∞–ø–∞ ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–æ—Ö–æ–¥–∞<br>
                    ü§ñ –ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞<br>
                    üíé –ì–µ–º—ã: 1 –∑–∞ –∫–∞–∂–¥—ã–µ 50 —Ç–∞–ø–æ–≤<br>
                    üéÅ –ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–∞ –Ω–∞–≥—Ä–∞–¥–æ–π
                </p>
            </div>
        </div>
    </div>

    <!-- NAV -->
    <div class="nav-bar">
        <div class="nav-item active" data-screen="game"><span>üéÆ</span><span>–ò–≥—Ä–∞</span></div>
        <div class="nav-item" data-screen="shop"><span>üõí</span><span>–ú–∞–≥–∞–∑–∏–Ω</span></div>
        <div class="nav-item" data-screen="top"><span>üèÜ</span><span>–¢–æ–ø</span></div>
        <div class="nav-item" data-screen="info"><span>üìñ</span><span>–ò–Ω—Ñ–æ</span></div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="toast"></div>

    <!-- DAILY MODAL -->
    <div id="daily-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-title">üéÅ –ù–∞–≥—Ä–∞–¥–∞ –¥–Ω—è <span id="modal-day">1</span></div>
            <div class="modal-icon">üéâ</div>
            <div class="modal-rewards">
                <div class="modal-reward">
                    <div class="modal-reward-icon">ü™ô</div>
                    <div class="modal-reward-amount" id="modal-gold">+100</div>
                </div>
                <div class="modal-reward">
                    <div class="modal-reward-icon">üíé</div>
                    <div class="modal-reward-amount" id="modal-gems">+1</div>
                </div>
            </div>
            <button class="modal-btn" id="claim-btn">–ó–∞–±—Ä–∞—Ç—å!</button>
        </div>
    </div>

<script>
// ========== CONFIG ==========
const API_URL = 'https://taproyaleserver.onrender.com';
const BOT_USERNAME = 'TapRoyaleGame_bot'; // <-- –ó–ê–ú–ï–ù–ò!

// ========== DATA ==========
const ARENAS = [
    { name: 'üè∞ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –ª–∞–≥–µ—Ä—å', lvl: 1, bg: 'linear-gradient(135deg, #2d5016, #1a3a0a)' },
    { name: '‚öîÔ∏è –î–µ—Ä–µ–≤–Ω—è –≥–æ–±–ª–∏–Ω–æ–≤', lvl: 5, bg: 'linear-gradient(135deg, #4a5d23, #2e3d14)' },
    { name: 'üèØ –ö–æ—Å—Ç—è–Ω–æ–π –ª–µ—Å', lvl: 12, bg: 'linear-gradient(135deg, #3d3d3d, #1a1a1a)' },
    { name: 'üé™ –í–∞—Ä–≤–∞—Ä—Å–∫–∞—è –∞—Ä–µ–Ω–∞', lvl: 20, bg: 'linear-gradient(135deg, #8b4513, #5d2e0a)' },
    { name: '‚õèÔ∏è –®–∞—Ö—Ç–∞ —Å–æ–∫—Ä–æ–≤–∏—â', lvl: 30, bg: 'linear-gradient(135deg, #6b4423, #3d2613)' },
    { name: 'üèõÔ∏è –ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –¥–≤–æ—Ä', lvl: 42, bg: 'linear-gradient(135deg, #4a148c, #311b92)' },
    { name: 'üåã –û–≥–Ω–µ–Ω–Ω—ã–π –ø–∏–∫', lvl: 55, bg: 'linear-gradient(135deg, #bf360c, #8d1c06)' },
    { name: '‚ùÑÔ∏è –õ–µ–¥—è–Ω–∞—è –ø—É—Å—Ç–æ—à—å', lvl: 70, bg: 'linear-gradient(135deg, #0277bd, #01579b)' },
    { name: '‚ö° –ù–µ–±–µ—Å–Ω–∞—è –±–∞—à–Ω—è', lvl: 88, bg: 'linear-gradient(135deg, #6a1b9a, #4a148c)' },
    { name: 'üëë –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è', lvl: 100, bg: 'linear-gradient(135deg, #ffd700, #b8860b)' }
];

const CHARS = ['üó°Ô∏è','üèπ','‚öîÔ∏è','üõ°Ô∏è','üëä','üßô','üêâ','üßä','ü§¥','üëë'];
const DAILY = [{g:100,d:1},{g:150,d:1},{g:200,d:2},{g:300,d:2},{g:400,d:3},{g:500,d:4},{g:750,d:5}];

// ========== STATE ==========
let G = {
    tgId: null,
    name: '–ò–≥—Ä–æ–∫',
    gold: 0,
    gems: 0,
    level: 1,
    exp: 0,
    taps: 0,
    tapsForGem: 0,
    upTap: 0, upAuto: 0, upExp: 0, upCrit: 0,
    costTap: 100, costAuto: 250, costExp: 500, costCrit: 1000,
    refs: 0,
    streak: 1,
    lastDaily: null,
    boostDouble: 0,
    boostSuper: 0
};

// ========== INIT ==========
function init() {
    load();
    initTG();
    initEvents();
    checkDaily();
    render();
    renderArenas();
    loadLeaderboard();

    setInterval(autoIncome, 1000);
    setInterval(updateBoosts, 1000);
    setInterval(syncServer, 30000);
}

function initTG() {
    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        const u = Telegram.WebApp.initDataUnsafe?.user;
        if (u) {
            G.tgId = u.id;
            G.name = u.first_name || '–ò–≥—Ä–æ–∫';
        }
        const sp = Telegram.WebApp.initDataUnsafe?.start_param;
        if (sp && sp.startsWith('ref')) {
            const refId = sp.replace('ref', '');
            if (refId && refId != G.tgId && !localStorage.getItem('refDone')) {
                G.gold += 500;
                G.gems += 3;
                localStorage.setItem('refDone', '1');
                toast('üéÅ –ë–æ–Ω—É—Å: +500 –∑–æ–ª–æ—Ç–∞, +3 –≥–µ–º–∞!', 'success');
                save();
            }
        }
    }
    updateRefLink();
}

function initEvents() {
    // Tap
    document.getElementById('character').addEventListener('click', tap);

    // Nav
    document.querySelectorAll('.nav-item').forEach(el => {
        el.addEventListener('click', () => switchScreen(el.dataset.screen));
    });

    // Shop tabs
    document.getElementById('tab-gold').addEventListener('click', () => switchShopTab('gold'));
    document.getElementById('tab-gems').addEventListener('click', () => switchShopTab('gems'));

    // Buy upgrades
    document.getElementById('buy-tap').addEventListener('click', () => buyUpgrade('tap'));
    document.getElementById('buy-auto').addEventListener('click', () => buyUpgrade('auto'));
    document.getElementById('buy-exp').addEventListener('click', () => buyUpgrade('exp'));
    document.getElementById('buy-crit').addEventListener('click', () => buyUpgrade('crit'));

    // Buy boosts
    document.getElementById('buy-double').addEventListener('click', () => buyBoost('double', 5));
    document.getElementById('buy-super').addEventListener('click', () => buyBoost('super', 10));
    document.getElementById('buy-megaexp').addEventListener('click', () => buyBoost('megaexp', 8));
    document.getElementById('buy-gold500').addEventListener('click', () => buyBoost('gold500', 3));

    // Daily
    document.getElementById('daily-banner').addEventListener('click', openDaily);
    document.getElementById('claim-btn').addEventListener('click', claimDaily);

    // Referral
    document.getElementById('invite-btn').addEventListener('click', invite);
    document.getElementById('copy-btn').addEventListener('click', copyLink);
}

// ========== GAME ==========
function tap(e) {
    let gold = 1 + G.upTap * 2;

    // Crit
    if (G.upCrit > 0 && Math.random() < G.upCrit * 0.05) {
        gold *= 3;
    }

    // Boosts
    if (G.boostDouble > Date.now()) gold *= 2;
    if (G.boostSuper > Date.now()) gold *= 10;

    G.gold += Math.floor(gold);
    G.taps++;
    G.tapsForGem++;

    // Gems
    if (G.tapsForGem >= 50) {
        G.gems++;
        G.tapsForGem = 0;
        toast('üíé +1 –≥–µ–º!', 'success');
    }

    // Exp
    G.exp += 1 + G.upExp;
    checkLevelUp();

    // Feedback
    showTapFeedback(e, gold);

    render();
    save();
}

function checkLevelUp() {
    let need = getExpNeed();
    while (G.exp >= need) {
        G.exp -= need;
        G.level++;
        toast('üéâ –£—Ä–æ–≤–µ–Ω—å ' + G.level + '!', 'success');
        need = getExpNeed();
    }
}

function getExpNeed() {
    return Math.floor(100 * Math.pow(1.5, G.level - 1));
}

function getGoldPerTap() {
    return 1 + G.upTap * 2;
}

function getGoldPerSec() {
    return G.upAuto * 5 + G.refs * 5;
}

function autoIncome() {
    const inc = getGoldPerSec();
    if (inc > 0) {
        let gold = inc;
        if (G.boostDouble > Date.now()) gold *= 2;
        G.gold += gold;
        render();
        save();
    }
}

// ========== SHOP ==========
function buyUpgrade(type) {
    let cost, level;
    if (type === 'tap') { cost = G.costTap; level = G.upTap; }
    else if (type === 'auto') { cost = G.costAuto; level = G.upAuto; }
    else if (type === 'exp') { cost = G.costExp; level = G.upExp; }
    else if (type === 'crit') { cost = G.costCrit; level = G.upCrit; }

    if (G.gold < cost) {
        toast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!', 'error');
        return;
    }

    G.gold -= cost;

    if (type === 'tap') { G.upTap++; G.costTap = Math.floor(G.costTap * 1.8); }
    else if (type === 'auto') { G.upAuto++; G.costAuto = Math.floor(G.costAuto * 1.8); }
    else if (type === 'exp') { G.upExp++; G.costExp = Math.floor(G.costExp * 1.8); }
    else if (type === 'crit') { G.upCrit++; G.costCrit = Math.floor(G.costCrit * 1.8); }

    toast('‚úÖ –ö—É–ø–ª–µ–Ω–æ!', 'success');
    render();
    save();
}

function buyBoost(type, cost) {
    if (G.gems < cost) {
        toast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–µ–º–æ–≤!', 'error');
        return;
    }

    G.gems -= cost;

    if (type === 'double') {
        G.boostDouble = Date.now() + 5 * 60 * 1000;
        toast('üî• x2 –∑–æ–ª–æ—Ç–æ –Ω–∞ 5 –º–∏–Ω!', 'success');
    } else if (type === 'super') {
        G.boostSuper = Date.now() + 60 * 1000;
        toast('üí• x10 —Ç–∞–ø –Ω–∞ 1 –º–∏–Ω!', 'success');
    } else if (type === 'megaexp') {
        G.exp += 1000;
        checkLevelUp();
        toast('‚≠ê +1000 –æ–ø—ã—Ç–∞!', 'success');
    } else if (type === 'gold500') {
        G.gold += 500;
        toast('üí∞ +500 –∑–æ–ª–æ—Ç–∞!', 'success');
    }

    render();
    save();
}

// ========== DAILY ==========
function checkDaily() {
    const today = new Date().toDateString();
    const banner = document.getElementById('daily-banner');

    if (G.lastDaily === today) {
        banner.classList.add('claimed');
        banner.querySelector('.daily-text').textContent = '–ü–æ–ª—É—á–µ–Ω–æ!';
        banner.querySelector('.daily-btn').textContent = '‚úì';
    } else {
        banner.classList.remove('claimed');
        banner.querySelector('.daily-text').textContent = '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞!';
        banner.querySelector('.daily-btn').textContent = '–ó–∞–±—Ä–∞—Ç—å';

        // Check streak
        if (G.lastDaily) {
            const last = new Date(G.lastDaily);
            const now = new Date(today);
            const diff = Math.floor((now - last) / 86400000);
            if (diff === 1) G.streak = Math.min(G.streak + 1, 7);
            else if (diff > 1) G.streak = 1;
        }
    }
}

function openDaily() {
    if (G.lastDaily === new Date().toDateString()) return;

    const r = DAILY[G.streak - 1] || DAILY[6];
    document.getElementById('modal-day').textContent = G.streak;
    document.getElementById('modal-gold').textContent = '+' + r.g;
    document.getElementById('modal-gems').textContent = '+' + r.d;
    document.getElementById('daily-modal').classList.add('show');
}

function claimDaily() {
    const r = DAILY[G.streak - 1] || DAILY[6];
    G.gold += r.g;
    G.gems += r.d;
    G.lastDaily = new Date().toDateString();

    document.getElementById('daily-modal').classList.remove('show');
    toast('üéÅ +' + r.g + ' –∑–æ–ª–æ—Ç–∞, +' + r.d + ' –≥–µ–º–æ–≤!', 'success');

    checkDaily();
    render();
    save();
}

// ========== UI ==========
function render() {
    // Header
    document.getElementById('player-name').textContent = G.name;
    document.getElementById('player-level').textContent = G.level;
    document.getElementById('gold-display').textContent = formatNum(G.gold);
    document.getElementById('gems-display').textContent = G.gems;

    // Shop currency
    document.getElementById('shop-gold').textContent = formatNum(G.gold);
    document.getElementById('shop-gems').textContent = G.gems;

    // Stats
    document.getElementById('gold-per-tap').textContent = '+' + getGoldPerTap();
    document.getElementById('gold-per-sec').textContent = '+' + getGoldPerSec();
    document.getElementById('total-taps').textContent = formatNum(G.taps);

    // Exp
    const need = getExpNeed();
    document.getElementById('current-exp').textContent = Math.floor(G.exp);
    document.getElementById('exp-needed').textContent = need;
    document.getElementById('exp-bar').style.width = (G.exp / need * 100) + '%';

    // Arena
    const arena = getArena();
    const nextArena = getNextArena();
    document.getElementById('arena-name').textContent = arena.name;
    document.getElementById('arena-container').style.background = arena.bg;

    const charIdx = Math.min(Math.floor(G.level / 10), CHARS.length - 1);
    document.getElementById('character').textContent = CHARS[charIdx];
    document.getElementById('arena-hero').textContent = CHARS[charIdx];

    if (nextArena) {
        document.getElementById('next-arena-level').textContent = nextArena.lvl;
        const prog = (G.level - arena.lvl) / (nextArena.lvl - arena.lvl) * 100;
        document.getElementById('arena-bar').style.width = prog + '%';
    } else {
        document.getElementById('next-arena-level').textContent = 'MAX';
        document.getElementById('arena-bar').style.width = '100%';
    }

    // Shop upgrades
    document.getElementById('lvl-tap').textContent = G.upTap;
    document.getElementById('cost-tap').textContent = formatNum(G.costTap);
    document.getElementById('lvl-auto').textContent = G.upAuto;
    document.getElementById('cost-auto').textContent = formatNum(G.costAuto);
    document.getElementById('lvl-exp').textContent = G.upExp;
    document.getElementById('cost-exp').textContent = formatNum(G.costExp);
    document.getElementById('lvl-crit').textContent = G.upCrit;
    document.getElementById('cost-crit').textContent = formatNum(G.costCrit);

    // Daily
    document.getElementById('daily-streak').textContent = G.streak;

    // Refs
    document.getElementById('ref-count').textContent = G.refs;
    document.getElementById('ref-bonus').textContent = '+' + (G.refs * 5);
}

function updateBoosts() {
    const c = document.getElementById('active-boosts');
    let html = '';
    const now = Date.now();

    if (G.boostDouble > now) {
        const sec = Math.ceil((G.boostDouble - now) / 1000);
        html += '<div class="boost-badge">üî• x2: ' + formatTime(sec) + '</div>';
    }
    if (G.boostSuper > now) {
        const sec = Math.ceil((G.boostSuper - now) / 1000);
        html += '<div class="boost-badge">üí• x10: ' + formatTime(sec) + '</div>';
    }

    c.innerHTML = html;
}

function showTapFeedback(e, amount) {
    const c = document.getElementById('arena-container');
    const rect = c.getBoundingClientRect();
    const fb = document.createElement('div');
    fb.className = 'tap-feedback';
    fb.textContent = '+' + amount;
    fb.style.left = (e.clientX - rect.left) + 'px';
    fb.style.top = (e.clientY - rect.top) + 'px';
    c.appendChild(fb);
    setTimeout(() => fb.remove(), 800);
}

function switchScreen(name) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('screen-' + name).classList.add('active');
    document.querySelector('[data-screen="' + name + '"]').classList.add('active');

    if (name === 'top') loadLeaderboard();
}

function switchShopTab(tab) {
    document.getElementById('tab-gold').classList.toggle('active', tab === 'gold');
    document.getElementById('tab-gems').classList.toggle('active', tab === 'gems');
    document.getElementById('shop-gold-items').style.display = tab === 'gold' ? 'flex' : 'none';
    document.getElementById('shop-gems-items').style.display = tab === 'gems' ? 'flex' : 'none';
}

function renderArenas() {
    let html = '';
    ARENAS.forEach(a => {
        const unlocked = G.level >= a.lvl;
        const current = getArena().name === a.name;
        html += '<div style="opacity:' + (unlocked ? 1 : 0.5) + '">';
        html += (current ? 'üìç ' : unlocked ? '‚úÖ ' : 'üîí ');
        html += a.name + ' (—É—Ä. ' + a.lvl + '+)</div>';
    });
    document.getElementById('arenas-list').innerHTML = html;
}

function toast(msg, type) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast ' + (type || '') + ' show';
    setTimeout(() => t.classList.remove('show'), 2500);
}

// ========== HELPERS ==========
function getArena() {
    let a = ARENAS[0];
    for (const ar of ARENAS) {
        if (G.level >= ar.lvl) a = ar;
    }
    return a;
}

function getNextArena() {
    for (const ar of ARENAS) {
        if (G.level < ar.lvl) return ar;
    }
    return null;
}

function formatNum(n) {
    if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
    if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
    return Math.floor(n).toString();
}

function formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return m + ':' + s.toString().padStart(2, '0');
}

// ========== REFERRAL ==========
function updateRefLink() {
    const id = G.tgId || 'demo';
    document.getElementById('ref-link').textContent = 't.me/' + BOT_USERNAME + '?startapp=ref' + id;
}

function invite() {
    const id = G.tgId || 'demo';
    const link = 'https://t.me/' + BOT_USERNAME + '?startapp=ref' + id;
    const text = 'üéÆ –ò–≥—Ä–∞–π –≤ Tap Royale! –Ø –Ω–∞ —É—Ä–æ–≤–Ω–µ ' + G.level + '!';

    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.openTelegramLink('https://t.me/share/url?url=' + encodeURIComponent(link) + '&text=' + encodeURIComponent(text));
    } else {
        copyLink();
    }
}

function copyLink() {
    const id = G.tgId || 'demo';
    const link = 'https://t.me/' + BOT_USERNAME + '?startapp=ref' + id;
    navigator.clipboard.writeText(link);
    toast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!', 'success');
}

// ========== LEADERBOARD ==========
async function loadLeaderboard() {
    const c = document.getElementById('leaderboard');
    c.innerHTML = '<div style="text-align:center;padding:20px">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';

    let data = [];
    try {
        const res = await fetch(API_URL + '/api/leaderboard?type=level');
        if (res.ok) data = await res.json();
    } catch(e) {}

    if (data.length === 0) {
        data = [
            { nickname: 'ProGamer', level: 95, arena: '‚ö° –ù–µ–±–µ—Å–Ω–∞—è –±–∞—à–Ω—è' },
            { nickname: 'TapMaster', level: 78, arena: '‚ùÑÔ∏è –õ–µ–¥—è–Ω–∞—è –ø—É—Å—Ç–æ—à—å' },
            { nickname: 'SpeedRunner', level: 48, arena: 'üèõÔ∏è –ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –¥–≤–æ—Ä' }
        ];
    }

    let html = '';
    data.slice(0, 10).forEach((p, i) => {
        const rank = i + 1;
        const rc = rank === 1 ? 'top1' : rank === 2 ? 'top2' : rank === 3 ? 'top3' : '';
        html += '<div class="leaderboard-item">';
        html += '<div class="rank ' + rc + '">' + rank + '</div>';
        html += '<div class="lb-info"><div class="lb-name">' + p.nickname + '</div>';
        html += '<div class="lb-arena">' + (p.arena || getArena().name) + '</div></div>';
        html += '<div class="lb-value">–£—Ä. ' + p.level + '</div></div>';
    });

    // Add me
    html += '<div class="leaderboard-item me">';
    html += '<div class="rank">...</div>';
    html += '<div class="lb-info"><div class="lb-name">' + G.name + ' (—Ç—ã)</div>';
    html += '<div class="lb-arena">' + getArena().name + '</div></div>';
    html += '<div class="lb-value">–£—Ä. ' + G.level + '</div></div>';

    c.innerHTML = html;
}

// ========== SAVE/LOAD ==========
function save() {
    try {
        localStorage.setItem('tapRoyale2', JSON.stringify(G));
    } catch(e) {}
}

function load() {
    try {
        const s = localStorage.getItem('tapRoyale2');
        if (s) {
            const d = JSON.parse(s);
            Object.assign(G, d);
        }
    } catch(e) {}
}

// ========== SERVER ==========
async function syncServer() {
    if (!G.tgId) return;
    try {
        await fetch(API_URL + '/api/sync', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tg_id: G.tgId,
                nickname: G.name,
                gold: G.gold,
                gems: G.gems,
                level: G.level,
                totalTaps: G.taps
            })
        });
    } catch(e) {}
}

// ========== START ==========
init();
</script>
</body>
</html>